<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Crop Tool | Crop Multiple Images Online</title>
  <meta name="description" content="Free online multi-crop tool. Upload an image, crop multiple parts at once, and download them instantly.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 40px 20px;
      color: #111827;
      display: flex;
      justify-content: center;
    }
    .container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      padding: 30px;
      max-width: 1000px;
      width: 100%;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }
    #upload {
      display: block;
      margin: 0 auto 20px auto;
    }
    #canvasWrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    canvas {
      border: 2px dashed #d1d5db;
      border-radius: 12px;
      cursor: crosshair;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      background: white;
      max-width: 100%;
      max-height: 600px;
    }
    #controls {
      text-align: center;
      margin-top: 20px;
    }
    button {
      margin: 0 10px;
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #2563eb;
    }
    .crops {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }
    .crop-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .crop-preview {
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 150px;
    }
    .ad-placeholder {
      margin: 20px auto;
      max-width: 728px;
      height: 90px;
      background-color: #e5e7eb;
      border: 2px dashed #9ca3af;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #6b7280;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Multi-Crop Tool</h1>

    <!-- Ad Placeholder Top -->
    <div class="ad-placeholder">Ad Placeholder (728x90)</div>

    <input type="file" id="upload" accept="image/*" />
    <div id="canvasWrapper">
      <canvas id="mainCanvas"></canvas>
    </div>
    <div id="controls">
      <button id="cropAll">Crop All</button>
      <button id="clearCrops">Clear Marks</button>
      <button id="undoCrop">Undo</button>
      <button id="clearTray">Clear Tray</button>
    </div>

    <!-- Ad Placeholder Bottom -->
    <div class="ad-placeholder">Ad Placeholder (728x90)</div>

    <div class="crops" id="cropsContainer"></div>
  </div>

  <script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const cropsContainer = document.getElementById('cropsContainer');
    const cropAllBtn = document.getElementById('cropAll');
    const clearBtn = document.getElementById('clearCrops');
    const undoBtn = document.getElementById('undoCrop');
    const clearTrayBtn = document.getElementById('clearTray');

    let image = new Image();
    let cropRects = [];
    let startX, startY, isDragging = false;
    let previewRect = null;
    let scale = 1;

    function redrawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(image, 0, 0, image.width * scale, image.height * scale);
      cropRects.forEach(drawRect);
      if (previewRect) drawRect(previewRect, true);
    }

    function drawRect(rect, isPreview = false) {
      ctx.strokeStyle = isPreview ? '#3b82f6' : '#ef4444';
      ctx.fillStyle = isPreview ? 'rgba(59, 130, 246, 0.1)' : 'rgba(239, 68, 68, 0.1)';
      ctx.lineWidth = 2;
      ctx.fillRect(rect.x, rect.y, rect.w, rect.h);
      ctx.strokeRect(rect.x, rect.y, rect.w, rect.h);
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
      };
    }

    function beginDrag(e) {
      const pos = getPos(e);
      startX = pos.x;
      startY = pos.y;
      isDragging = true;
      previewRect = null;
    }

    function duringDrag(e) {
      if (!isDragging) return;
      const pos = getPos(e);
      previewRect = {
        x: Math.min(startX, pos.x),
        y: Math.min(startY, pos.y),
        w: Math.abs(pos.x - startX),
        h: Math.abs(pos.y - startY)
      };
      redrawCanvas();
    }

    function endDrag(e) {
      if (!isDragging || !previewRect || previewRect.w === 0 || previewRect.h === 0) {
        isDragging = false;
        previewRect = null;
        return;
      }
      cropRects.push(previewRect);
      isDragging = false;
      previewRect = null;
      redrawCanvas();
    }

    upload.addEventListener('change', e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        image.onload = () => {
          const maxDim = 800;
          scale = Math.min(maxDim / image.width, maxDim / image.height, 1);
          canvas.width = image.width * scale;
          canvas.height = image.height * scale;
          redrawCanvas();
        };
        image.src = reader.result;
      };
      if (file) reader.readAsDataURL(file);
    });

    canvas.addEventListener('mousedown', beginDrag);
    canvas.addEventListener('mousemove', duringDrag);
    canvas.addEventListener('mouseup', endDrag);
    canvas.addEventListener('touchstart', beginDrag);
    canvas.addEventListener('touchmove', duringDrag);
    canvas.addEventListener('touchend', endDrag);

    cropAllBtn.addEventListener('click', () => {
      cropRects.forEach((r, i) => {
        const cropCanvas = document.createElement('canvas');
        cropCanvas.width = r.w / scale;
        cropCanvas.height = r.h / scale;
        const cropCtx = cropCanvas.getContext('2d');
        cropCtx.drawImage(
          image,
          r.x / scale,
          r.y / scale,
          r.w / scale,
          r.h / scale,
          0,
          0,
          r.w / scale,
          r.h / scale
        );
        cropCanvas.className = 'crop-preview';

        const wrapper = document.createElement('div');
        wrapper.className = 'crop-item';
        wrapper.appendChild(cropCanvas);

        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = 'Download';
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.download = `crop_${i+1}.png`;
          link.href = cropCanvas.toDataURL();
          link.click();
        };
        wrapper.appendChild(downloadBtn);

        cropsContainer.appendChild(wrapper);
      });
    });

    clearBtn.addEventListener('click', () => {
      cropRects = [];
      redrawCanvas();
    });

    undoBtn.addEventListener('click', () => {
      cropRects.pop();
      redrawCanvas();
    });

    clearTrayBtn.addEventListener('click', () => {
      cropsContainer.innerHTML = '';
    });
  </script>
</body>
</html>
